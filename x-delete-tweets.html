<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tweet Deleter</title>
</head>
<body style="font-family: sans-serif; padding: 2rem">
  <h1>ðŸ§¹ Tweet Deleter</h1>
  <p>Select your <code>tweet-headers.js</code> file from your Twitter Data Export.</p>
  <input type="file" id="fileInput" accept=".js,.json" />
  <button id="startBtn" disabled>Start Deleting Tweets</button>
  <pre id="log" style="background:#111;color:#0f0;padding:1rem;margin-top:1rem;max-height:300px;overflow:auto"></pre>

  <script>
    let tweetIds = []

    const log = (...args) => {
      const el = document.getElementById("log")
      args.forEach(msg => el.textContent += msg + "\n")
      el.scrollTop = el.scrollHeight
      console.log(...args)
    }

    const extractTweetIds = (text) => {
      try {
        const cut = text.indexOf("=")
        const raw = text.slice(cut + 1)
        const json = JSON.parse(raw)
        return json.map(t => t.tweet?.tweet_id || t.tweet?.id_str).filter(Boolean)
      } catch (err) {
        log("âŒ Failed to parse file:", err.message)
        return []
      }
    }

    document.getElementById("fileInput").addEventListener("change", async (e) => {
      const file = e.target.files[0]
      const text = await file.text()
      tweetIds = extractTweetIds(text)
      if (tweetIds.length > 0) {
        document.getElementById("startBtn").disabled = false
        log(`âœ… Loaded ${tweetIds.length} tweets from file.`)
      } else {
        log("âŒ No tweet IDs found.")
      }
    })

    document.getElementById("startBtn").addEventListener("click", async () => {
      const ct0 = document.cookie.match(/ct0=([^;]+)/)?.[1]
      const bearer = "Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA"

      const deleteTweet = async (id) => {
        const res = await fetch("https://x.com/i/api/graphql/VaenaVgh5q5ih7kvyVjgtg/DeleteTweet", {
          method: "POST",
          credentials: "include",
          headers: {
            authorization: bearer,
            "content-type": "application/json",
            "x-csrf-token": ct0,
            "x-twitter-auth-type": "OAuth2Session",
            "x-twitter-active-user": "yes"
          },
          body: JSON.stringify({
            variables: { tweet_id: id, dark_request: false },
            queryId: "VaenaVgh5q5ih7kvyVjgtg"
          })
        })

        return res.status === 200
      }

      const CONCURRENCY = 5
      const DELAY = 1500
      let completed = 0

      for (let i = 0; i < tweetIds.length; i += CONCURRENCY) {
        const batch = tweetIds.slice(i, i + CONCURRENCY)

        await Promise.all(batch.map(async (id) => {
          const ok = await deleteTweet(id)
          completed++
          log(`${completed}/${tweetIds.length} ${ok ? "âœ…" : "âŒ"} Deleted ${id}`)
        }))

        await new Promise(r => setTimeout(r, DELAY))
      }

      log("ðŸŽ‰ All done.")
    })
  </script>
</body>
</html>
